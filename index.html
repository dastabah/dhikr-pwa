<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#059669">
  <meta name="description" content="A tool for consistent spiritual practice and learning">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Zawiya">
  
  <title>Digital Zawiya</title>
  
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>☪️</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>☪️</text></svg>">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    .font-arabic {
      font-family: 'Amiri', serif;
    }
    body {
      overscroll-behavior-y: contain;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide Icons as inline SVG components
    const Home = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
    );

    const BookOpen = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
    );

    const Heart = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path>
      </svg>
    );

    const SettingsIcon = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
    );

    const ChevronDown = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m6 9 6 6 6-6"></path>
      </svg>
    );

    const ChevronUp = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m18 15-6-6-6 6"></path>
      </svg>
    );

    const Menu = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="4" x2="20" y1="12" y2="12"></line>
        <line x1="4" x2="20" y1="6" y2="6"></line>
        <line x1="4" x2="20" y1="18" y2="18"></line>
      </svg>
    );

    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M18 6 6 18"></path>
        <path d="m6 6 12 12"></path>
      </svg>
    );

    // Utility Functions
    const useLocalStorage = (key, initialValue) => {
      const [value, setValue] = useState(() => {
        try {
          const item = window.localStorage.getItem(key);
          return item ? JSON.parse(item) : initialValue;
        } catch {
          return initialValue;
        }
      });

      useEffect(() => {
        try {
          window.localStorage.setItem(key, JSON.stringify(value));
        } catch (error) {
          console.error('Error saving to localStorage:', error);
        }
      }, [key, value]);

      return [value, setValue];
    };

    const isIOS = () => {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    };

    const triggerHaptic = (count, totalCount) => {
      if (isIOS()) {
        return 'flash';
      } else if ('vibrate' in navigator) {
        if (count === totalCount) {
          navigator.vibrate([100, 50, 100, 50, 100]);
        } else if (count % 33 === 0 && count !== 0) {
          navigator.vibrate([50, 30, 50]);
        }
      }
      return null;
    };

    // Data
    const DHIKR_DATA = [
      {
        name: 'Istighfar',
        arabic: 'أَسْتَغْفِرُ اللهَ',
        transliteration: 'Astaghfirullah',
        english: 'I seek forgiveness from Allah',
        count: 100,
        metaphor: 'The Spiritual Shower',
        niyyah: 'Go to Allah with your heart, with remorse. Beg Him to grant you His maghfirah (forgiveness). Not just with your tongue.'
      },
      {
        name: 'Tahlil',
        arabic: 'لَا إِلٰهَ إِلَّا اللهُ',
        transliteration: 'La ilaha illAllah',
        english: 'There is no deity except Allah',
        count: 100,
        metaphor: 'The Spiritual Strength',
        niyyah: 'As you recite, deny anyone\'s power but Allah, and affirm that He is the only source. Bring your heart to this.'
      },
      {
        name: 'Salawat',
        arabic: 'اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ وَعَلَى آلِ مُحَمَّدٍ',
        transliteration: 'Allahumma salli \'ala Muhammadin wa \'ala ali Muhammad',
        english: 'O Allah, send blessings upon Muhammad and the family of Muhammad',
        count: 100,
        metaphor: 'The Spiritual Fragrance',
        niyyah: 'You are presenting the salah to the Prophet ﷺ... He replies back to you, so bring your heart to a station of reception.'
      }
    ];

    const FOUNDATION_CARDS = [
      {
        id: 'name',
        title: 'What does "Alawi Husayni Ninowi" mean?',
        hook: 'Our name is our lineage and our mission.',
        context: `'Alawi refers to our spiritual authority tracing to Sayyiduna 'Ali ibn Abi Talib (ra). Husayni connects us to Imam al-Husayn (ra), the master of martyrs and symbol of standing for truth. Ninowi refers to Nineveh, near Karbala, a symbol of Tazkiyah (purification) and sacrifice.`,
        teaching: {
          title: 'Our Methodology: The Sufism of Ahl al-Hadith',
          content: `Our path is the Sufism of Ahl al-Hadith - the purification of the heart based strictly on the Qur'an and authentic Sunnah. We follow the four Sunni madhhabs, hold the 'Aqidah of Ahl al-Sunnah, and trace our lineage through the greatest Imams of guidance.`
        }
      },
      {
        id: 'ahlulbayt',
        title: 'Why do we love the Ahlul Bayt?',
        hook: 'Love for the Ahlul Bayt is an obligation from the Qur\'an.',
        context: `The Prophet ﷺ said: "I am leaving among you two weighty things: the Book of Allah and my Ahlul Bayt." (Sahih Muslim). They are the Safinat al-Najat (The Ark of Salvation) - whoever holds onto them is saved, and whoever abandons them is drowned.`,
        teaching: {
          title: 'The Ark of Salvation',
          content: `Loving the Ahlul Bayt is not optional sentiment - it is a religious obligation. They are the inheritors of prophetic knowledge and the means to understanding true Tazkiyah. Following them is the methodology of the Sunnah.`
        }
      },
      {
        id: 'tazkiyah',
        title: 'What is Tazkiyah (Purification)?',
        hook: '"He has succeeded who purifies it" (Qur\'an 91:9)',
        context: `Tazkiyah is the purification of the heart - the removal of spiritual diseases like pride, envy, and heedlessness. As Sayyidi teaches, Tazkiyah is the Imam (Leader) of 'Ilm (Knowledge). Without a purified heart, knowledge becomes a burden rather than a blessing.`,
        teaching: {
          title: 'The 3-Stage Curriculum',
          content: `The path has three stages: Takhalli (emptying the heart of vice), Tahalli (filling it with virtue), and Tajalli (illumination by Allah's presence). The goal is to move from "I have to do it" to "I love to do it."`
        }
      },
      {
        id: 'khidmah',
        title: 'What is Khidmah (Servitude)?',
        hook: 'After Tawheed comes Khidmah.',
        context: `As Sayyidi teaches: "After Tawheed (affirming the Creator) comes Khidmah (serving the creation)." This is the fruit of your Tazkiyah and the truest form of dawah. People don't need more lectures - they need to see Sufism lived: khidmah, adab, mahabbah, brotherhood and sisterhood.`,
        teaching: {
          title: 'The Empty Gate - Imam al-Jilani',
          content: `Imam 'Abd al-Qadir al-Jilani (ra) teaches that on the Day of Judgment, there will be a gate called "The Gate of Service." Most will enter through their prayers, fasting, and worship. But this special gate will be empty - reserved only for those who served Allah's creation selflessly.`
        }
      }
    ];

    const SILSILAH_FIGURES = [
      {
        id: 'prophet',
        name: 'The Prophet Muhammad ﷺ',
        quote: 'His mercy was more convincing than argument, more powerful than legislation.',
        context: `The Seal of Prophets and the Best of Creation. His life is the perfect embodiment of the Qur'an, and his character is the model for all humanity. Following his Sunnah is not mere imitation - it is the path to Divine love.`,
        teachings: [
          {
            title: 'The Goal of Sunnah is Love',
            content: `The Prophet ﷺ said: "None of you truly believes until I am more beloved to him than his own self." The goal of following the Sunnah is not rigidity - it is to fall in love with the one who lived it.`
          }
        ]
      },
      {
        id: 'ali',
        name: 'Sayyiduna \'Ali ibn Abi Talib (ra)',
        quote: 'I am the city of knowledge, and \'Ali is its gate.',
        context: `The Lion of Allah, the fourth Rightly-Guided Caliph, and the gate to prophetic knowledge. He is the spiritual father of Tasawwuf (Sufism) and the source from whom most Sufi chains trace their lineage.`,
        teachings: [
          {
            title: 'The Gate of Knowledge',
            content: `The Prophet ﷺ declared 'Ali the gate to the city of his knowledge. To enter the depths of prophetic wisdom, one must pass through this blessed gate.`
          },
          {
            title: 'The Source of Tazkiyah',
            content: `'Ali (ra) was the first to receive the secrets of spiritual purification directly from the Prophet ﷺ. His teachings on combating the nafs (ego) remain unmatched.`
          }
        ]
      },
      {
        id: 'fatima',
        name: 'Sayyidatuna Fatima al-Zahra (ra)',
        quote: 'Fatima is a part of me. Whoever angers her has angered me.',
        context: `The Queen of Paradise, daughter of the Prophet ﷺ, wife of 'Ali, and mother of al-Hasan and al-Husayn. She embodies the perfection of femininity, worship, and spiritual nobility.`,
        teachings: [
          {
            title: 'Al-Zahra (The Radiant One)',
            content: `Her face would shine with nur (divine light) during prayer. This physical radiance reflected the purity of her heart and the strength of her connection to Allah.`
          },
          {
            title: 'The Perfect Example',
            content: `Despite living in poverty, she never complained. Her contentment with Allah's decree and her service to her family make her the ultimate role model for women and men alike.`
          }
        ]
      },
      {
        id: 'sayyidain',
        name: 'The Sayyidain: Imams al-Hasan & al-Husayn (ra)',
        quote: 'These two are the masters of the youth of Paradise.',
        context: `The twin pillars of the Ummah, grandsons of the Prophet ﷺ. Al-Hasan taught us forbearance and unity; al-Husayn taught us to stand for truth even unto death. Together, they are the inheritors of prophetic love.`,
        teachings: [
          {
            title: 'Al-Hasan: The Forbearing Unifier',
            content: `Imam al-Hasan (ra) gave up his right to leadership to prevent bloodshed among Muslims. His hilm (forbearance) saved the Ummah from civil war.`
          },
          {
            title: 'Al-Husayn: The Ultimate Ihsan',
            content: `At Karbala, surrounded and thirsty, Imam al-Husayn (ra) demonstrated the highest station: to worship Allah with absolute certainty, even when hope seems lost. This is the path of Tazkiyah.`
          }
        ]
      },
      {
        id: 'ghazali',
        name: 'Imam Abu Hamid al-Ghazali (ra)',
        quote: 'Hujjat al-Islam (The Proof of Islam)',
        context: `The great reviver of the religion, who bridged scholastic knowledge and spiritual purification. His works remain essential reading for anyone seeking to understand the heart of Islam.`,
        teachings: [
          {
            title: 'Knowledge of the Heart',
            content: `Imam al-Ghazali taught that knowledge without purification leads to arrogance. True 'ilm must transform the heart, not just fill the mind.`
          }
        ]
      },
      {
        id: 'jilani',
        name: 'Shaykh \'Abd al-Qadir al-Jilani (ra)',
        quote: 'Sultan al-Awliya (The King of the Saints)',
        context: `The greatest of the Awliya, founder of the Qadiri order. His spiritual station was so elevated that scholars would recite Fatiha when passing his house. His teachings emphasize reliance on Allah alone.`,
        teachings: [
          {
            title: 'The Empty Gate',
            content: `On the Day of Judgment, there will be a gate called "The Gate of Service." While most enter through worship, this special gate remains empty - reserved only for those who served Allah's creation selflessly.`
          }
        ]
      }
    ];

    const MY_PATH_SECTIONS = [
      {
        id: 'wadhifa',
        title: 'Your Spiritual Wadhifa',
        content: {
          daily: {
            title: 'The Daily Wird',
            items: DHIKR_DATA
          },
          weekly: {
            title: 'The Weekly Awrad',
            description: 'A comprehensive litany of Qur\'an, Salawat, and du\'a to be read once per week.',
            status: 'coming_soon'
          }
        }
      },
      {
        id: 'academic',
        title: 'Your Academic Wadhifa',
        content: {
          items: [
            {
              title: 'Aqidah (Creed)',
              description: 'Study the text \'Aqidah al-Tahawiyyah\' - the definitive statement of Sunni orthodoxy.',
              action: 'Commit to studying one section per month with a teacher or study circle.'
            },
            {
              title: 'Fiqh (Jurisprudence)',
              description: 'Choose one of the four great Sunni madhhabs and study its foundations.',
              action: 'Begin with a primer text appropriate to your level and madhhab.'
            },
            {
              title: 'Suhba (Companionship)',
              description: 'Listen to at least one khutba or lecture by our Shaykh weekly.',
              action: 'This ensures you stay connected to living guidance and benefit from the barakah of the Shaykh\'s words.'
            }
          ]
        }
      },
      {
        id: 'adab',
        title: 'The Adab & Inner Meanings',
        content: {
          outer: {
            title: 'The Outer Adab',
            checklist: [
              'Be in a state of wudu (ablution)',
              'Face the Qibla if possible',
              'Find a quiet, clean place',
              'Sit with adab (proper posture)',
              'Lower your gaze',
              'Silence your phone'
            ]
          },
          inner: {
            title: 'The Inner Adab',
            sections: DHIKR_DATA.map(d => ({
              name: d.name,
              metaphor: d.metaphor,
              teaching: d.niyyah
            }))
          }
        }
      },
      {
        id: 'khidmah',
        title: 'The Path of Khidmah',
        content: {
          hook: 'After Tawheed comes Khidmah.',
          context: 'The fruit of your Tazkiyah is Khidmah (service to creation). True dawah is not lectures - it is when people see Sufism lived through khidmah, adab, mahabbah, and authentic brotherhood/sisterhood. This app is merely a catalyst for you to find real-world service opportunities.',
          teachings: [
            {
              title: 'The Empty Gate',
              content: 'Imam \'Abd al-Qadir al-Jilani (ra) teaches that on the Day of Judgment, most will enter Paradise through the gates of prayer, fasting, charity, and other acts of worship. But there will be one special gate - "The Gate of Service" - that will be almost empty, reserved for those rare souls who served Allah\'s creation purely for His sake.'
            },
            {
              title: 'The School of the Sahaba',
              content: 'Look at the Ansar (Helpers of Madinah) who gave everything to the Muhajirun (Emigrants). They didn\'t wait for permission - they saw a need and filled it. This is the school we follow: see the need, fill the need, expect nothing in return.'
            }
          ]
        }
      }
    ];

    // Components
    const Onboarding = ({ onComplete }) => {
      const [step, setStep] = useState(0);

      const screens = [
        {
          title: 'As-salamu \'alaykum',
          content: 'Welcome to the Digital Zawiya',
          button: 'Start Here'
        },
        {
          title: FOUNDATION_CARDS[0].title,
          content: `${FOUNDATION_CARDS[0].context}\n\n${FOUNDATION_CARDS[0].teaching.content}`,
          button: 'Continue'
        },
        {
          title: FOUNDATION_CARDS[1].title,
          content: `${FOUNDATION_CARDS[1].context}\n\n${FOUNDATION_CARDS[1].teaching.content}`,
          button: 'Continue'
        },
        {
          title: FOUNDATION_CARDS[2].title,
          content: `${FOUNDATION_CARDS[2].context}\n\n${FOUNDATION_CARDS[2].teaching.content}`,
          button: 'Continue'
        },
        {
          title: FOUNDATION_CARDS[3].title,
          content: `${FOUNDATION_CARDS[3].context}\n\n${FOUNDATION_CARDS[3].teaching.content}`,
          button: 'Continue'
        },
        {
          title: 'You\'re ready to begin your journey',
          content: 'May Allah bless your path and grant you sincerity in all your actions.',
          button: 'Enter the Zawiya'
        }
      ];

      const currentScreen = screens[step];
      const isLastStep = step === screens.length - 1;

      return (
        <div className="min-h-screen bg-gradient-to-br from-emerald-50 to-teal-50 flex items-center justify-center p-6">
          <div className="max-w-2xl w-full bg-white rounded-2xl shadow-xl p-8">
            <h1 className="text-3xl font-bold text-gray-900 mb-6">{currentScreen.title}</h1>
            <div className="text-gray-700 text-lg leading-relaxed whitespace-pre-line mb-8">
              {currentScreen.content}
            </div>
            <button
              onClick={() => {
                if (isLastStep) {
                  onComplete();
                } else {
                  setStep(step + 1);
                }
              }}
              className="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-4 px-6 rounded-xl transition-colors"
            >
              {currentScreen.button}
            </button>
            {!isLastStep && (
              <div className="mt-4 flex justify-center gap-2">
                {screens.map((_, idx) => (
                  <div
                    key={idx}
                    className={`h-2 w-2 rounded-full ${
                      idx === step ? 'bg-emerald-600' : 'bg-gray-300'
                    }`}
                  />
                ))}
              </div>
            )}
          </div>
        </div>
      );
    };

    const WirdCounter = ({ mode, currentDhikr, count, onTap, onComplete, onExit }) => {
      const [flash, setFlash] = useState(false);
      const [showMenu, setShowMenu] = useState(false);
      const dhikr = DHIKR_DATA[currentDhikr];

      const handleTap = () => {
        const newCount = count + 1;
        onTap(newCount);

        const feedback = triggerHaptic(newCount, dhikr.count);
        if (feedback === 'flash') {
          setFlash(true);
          setTimeout(() => setFlash(false), 150);
        }

        if (newCount >= dhikr.count) {
          setTimeout(() => {
            if (currentDhikr < 2) {
              onComplete(currentDhikr + 1);
            } else {
              onComplete('muraqabah');
            }
          }, 500);
        }
      };

      const modeClass = mode === 'C' ? 'opacity-30' : 'opacity-100';

      return (
        <div className={`min-h-screen bg-gradient-to-br from-teal-100 via-emerald-100 to-cyan-100 flex flex-col items-center justify-center p-6 relative ${flash ? 'bg-white' : ''}`}>
          <button
            onClick={() => setShowMenu(!showMenu)}
            className="absolute top-6 right-6 text-gray-700 hover:text-gray-900 transition-colors z-10"
          >
            {showMenu ? <X size={28} /> : <Menu size={28} />}
          </button>

          {showMenu && (
            <div className="absolute top-20 right-6 bg-white rounded-xl shadow-2xl p-4 w-64 z-20">
              <div className="space-y-2">
                <button
                  onClick={() => {
                    alert('Mode switching coming soon');
                    setShowMenu(false);
                  }}
                  className="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100"
                >
                  Switch Mode
                </button>
                <button
                  onClick={() => {
                    alert('Adab & Niyyah review coming soon');
                    setShowMenu(false);
                  }}
                  className="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100"
                >
                  Review Adab & Niyyah
                </button>
                <button
                  onClick={onExit}
                  className="w-full text-left px-4 py-2 rounded-lg hover:bg-red-100 text-red-600"
                >
                  End Session
                </button>
              </div>
            </div>
          )}

          <div className={`text-center mb-12 ${modeClass}`}>
            <h2 className="text-4xl font-bold text-gray-900 mb-2">{dhikr.name}</h2>
            <div className="text-6xl font-bold text-emerald-700">{count} / {dhikr.count}</div>
          </div>

          <div
            onClick={handleTap}
            className={`cursor-pointer select-none ${mode === 'C' ? 'w-full h-64' : ''}`}
          >
            {mode === 'B' ? (
              <div className="bg-white bg-opacity-80 rounded-3xl p-12 shadow-2xl hover:shadow-3xl transition-shadow">
                <div className="text-center">
                  <div className="text-7xl mb-6">☪️</div>
                  <div className="text-3xl font-arabic text-gray-900 mb-3">{dhikr.arabic}</div>
                  <div className="text-xl text-gray-600 italic">{dhikr.transliteration}</div>
                </div>
              </div>
            ) : (
              <div className={`text-center ${modeClass}`}>
                <div className="text-5xl mb-4">☪️</div>
                <div className="text-2xl font-arabic text-gray-800">{dhikr.arabic}</div>
                <div className="text-sm text-gray-600 mt-2">Tap anywhere</div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const MuraqabahTimer = ({ onComplete }) => {
      const [seconds, setSeconds] = useState(180);

      useEffect(() => {
        if (seconds <= 0) {
          onComplete();
          return;
        }

        const timer = setInterval(() => {
          setSeconds(s => s - 1);
        }, 1000);

        return () => clearInterval(timer);
      }, [seconds, onComplete]);

      const minutes = Math.floor(seconds / 60);
      const secs = seconds % 60;

      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-100 to-purple-100 flex flex-col items-center justify-center p-6">
          <h2 className="text-4xl font-bold text-gray-900 mb-8">Final Muraqabah</h2>
          <div className="text-8xl font-bold text-indigo-700 mb-8">
            {minutes}:{secs.toString().padStart(2, '0')}
          </div>
          <p className="text-xl text-gray-700 text-center max-w-md">
            Sit in silent contemplation. Feel Allah's presence. Let your heart settle.
          </p>
        </div>
      );
    };

    const FoundationCard = ({ card }) => {
      const [expanded, setExpanded] = useState(false);

      return (
        <div className="bg-white rounded-xl shadow-md overflow-hidden mb-4">
          <button
            onClick={() => setExpanded(!expanded)}
            className="w-full text-left p-6 hover:bg-gray-50 transition-colors"
          >
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <h3 className="text-xl font-bold text-gray-900 mb-2">{card.title}</h3>
                <p className="text-gray-600 italic">{card.hook}</p>
              </div>
              {expanded ? <ChevronUp /> : <ChevronDown />}
            </div>
          </button>

          {expanded && (
            <div className="px-6 pb-6 space-y-4">
              <div className="pt-4 border-t">
                <p className="text-gray-700 leading-relaxed">{card.context}</p>
              </div>
              <div className="bg-emerald-50 rounded-lg p-4">
                <h4 className="font-bold text-emerald-900 mb-2">{card.teaching.title}</h4>
                <p className="text-emerald-800">{card.teaching.content}</p>
              </div>
            </div>
          )}
        </div>
      );
    };

    const SilsilahCard = ({ figure }) => {
      const [expanded, setExpanded] = useState(false);

      return (
        <div className="bg-white rounded-xl shadow-md overflow-hidden mb-4">
          <button
            onClick={() => setExpanded(!expanded)}
            className="w-full text-left p-6 hover:bg-gray-50 transition-colors"
          >
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <h3 className="text-xl font-bold text-gray-900 mb-2">{figure.name}</h3>
                <p className="text-gray-600 italic">"{figure.quote}"</p>
              </div>
              {expanded ? <ChevronUp /> : <ChevronDown />}
            </div>
          </button>

          {expanded && (
            <div className="px-6 pb-6 space-y-4">
              <div className="pt-4 border-t">
                <p className="text-gray-700 leading-relaxed">{figure.context}</p>
              </div>
              {figure.teachings.map((teaching, idx) => (
                <div key={idx} className="bg-teal-50 rounded-lg p-4">
                  <h4 className="font-bold text-teal-900 mb-2">{teaching.title}</h4>
                  <p className="text-teal-800">{teaching.content}</p>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    };

    const PathSection = ({ section }) => {
      const [expanded, setExpanded] = useState(false);

      const renderContent = () => {
        if (section.id === 'wadhifa') {
          return (
            <div className="space-y-6">
              <div>
                <h4 className="font-bold text-lg text-gray-900 mb-4">{section.content.daily.title}</h4>
                {section.content.daily.items.map((item, idx) => (
                  <div key={idx} className="bg-emerald-50 rounded-lg p-4 mb-3">
                    <div className="text-3xl font-arabic text-center mb-2">{item.arabic}</div>
                    <div className="text-center text-gray-700 italic mb-1">{item.transliteration}</div>
                    <div className="text-center text-gray-600 text-sm">{item.english}</div>
                    <div className="text-center text-emerald-700 font-semibold mt-2">({item.count}x)</div>
                  </div>
                ))}
              </div>
              <div className="bg-gray-100 rounded-lg p-4">
                <h4 className="font-bold text-lg text-gray-900 mb-2">{section.content.weekly.title}</h4>
                <p className="text-gray-600 mb-3">{section.content.weekly.description}</p>
                <button
                  disabled
                  className="w-full bg-gray-300 text-gray-600 py-2 px-4 rounded-lg cursor-not-allowed"
                >
                  Coming Soon
                </button>
              </div>
            </div>
          );
        }

        if (section.id === 'academic') {
          return (
            <div className="space-y-4">
              {section.content.items.map((item, idx) => (
                <div key={idx} className="bg-teal-50 rounded-lg p-4">
                  <h4 className="font-bold text-teal-900 mb-2">{item.title}</h4>
                  <p className="text-gray-700 mb-2">{item.description}</p>
                  <p className="text-teal-800 text-sm italic">{item.action}</p>
                </div>
              ))}
            </div>
          );
        }

        if (section.id === 'adab') {
          return (
            <div className="space-y-6">
              <div>
                <h4 className="font-bold text-lg text-gray-900 mb-3">{section.content.outer.title}</h4>
                <ul className="space-y-2">
                  {section.content.outer.checklist.map((item, idx) => (
                    <li key={idx} className="flex items-center text-gray-700">
                      <span className="text-emerald-600 mr-2">✓</span>
                      {item}
                    </li>
                  ))}
                </ul>
              </div>
              <div>
                <h4 className="font-bold text-lg text-gray-900 mb-3">{section.content.inner.title}</h4>
                {section.content.inner.sections.map((s, idx) => (
                  <div key={idx} className="bg-indigo-50 rounded-lg p-4 mb-3">
                    <h5 className="font-bold text-indigo-900 mb-1">
                      {s.name} ({s.metaphor})
                    </h5>
                    <p className="text-indigo-800 text-sm italic">{s.teaching}</p>
                  </div>
                ))}
              </div>
            </div>
          );
        }

        if (section.id === 'khidmah') {
          return (
            <div className="space-y-4">
              <div className="bg-amber-50 rounded-lg p-4">
                <div className="text-xl font-bold text-amber-900 mb-2">{section.content.hook}</div>
                <p className="text-gray-700">{section.content.context}</p>
              </div>
              {section.content.teachings.map((teaching, idx) => (
                <div key={idx} className="bg-rose-50 rounded-lg p-4">
                  <h4 className="font-bold text-rose-900 mb-2">{teaching.title}</h4>
                  <p className="text-rose-800">{teaching.content}</p>
                </div>
              ))}
            </div>
          );
        }
      };

      return (
        <div className="bg-white rounded-xl shadow-md overflow-hidden mb-4">
          <button
            onClick={() => setExpanded(!expanded)}
            className="w-full text-left p-6 hover:bg-gray-50 transition-colors"
          >
            <div className="flex items-center justify-between">
              <h3 className="text-xl font-bold text-gray-900">{section.title}</h3>
              {expanded ? <ChevronUp /> : <ChevronDown />}
            </div>
          </button>

          {expanded && (
            <div className="px-6 pb-6">
              {renderContent()}
            </div>
          )}
        </div>
      );
    };

    // Main App
    const DigitalZawiyaApp = () => {
      const [onboardingComplete, setOnboardingComplete] = useLocalStorage('onboarding_complete', false);
      const [activeTab, setActiveTab] = useState('home');
      const [countingMode, setCountingMode] = useLocalStorage('counting_mode', 'B');
      const [hapticEnabled, setHapticEnabled] = useLocalStorage('haptic_enabled', true);
      
      const [wirdActive, setWirdActive] = useState(false);
      const [currentDhikr, setCurrentDhikr] = useState(0);
      const [count, setCount] = useState(0);
      const [inMuraqabah, setInMuraqabah] = useState(false);

      if (!onboardingComplete) {
        return <Onboarding onComplete={() => setOnboardingComplete(true)} />;
      }

      const startWird = () => {
        setWirdActive(true);
        setCurrentDhikr(0);
        setCount(0);
        setInMuraqabah(false);
      };

      const handleTap = (newCount) => {
        setCount(newCount);
      };

      const handleDhikrComplete = (next) => {
        if (next === 'muraqabah') {
          setInMuraqabah(true);
        } else {
          setCurrentDhikr(next);
          setCount(0);
        }
      };

      const handleMuraqabahComplete = () => {
        setWirdActive(false);
        setInMuraqabah(false);
        setCurrentDhikr(0);
        setCount(0);
        alert('Allahu Akbar! Your wird is complete. May Allah accept it from you.');
      };

      const exitWird = () => {
        if (confirm('Are you sure you want to end your session?')) {
          setWirdActive(false);
          setInMuraqabah(false);
          setCurrentDhikr(0);
          setCount(0);
        }
      };

      if (wirdActive) {
        if (inMuraqabah) {
          return <MuraqabahTimer onComplete={handleMuraqabahComplete} />;
        }
        return (
          <WirdCounter
            mode={countingMode}
            currentDhikr={currentDhikr}
            count={count}
            onTap={handleTap}
            onComplete={handleDhikrComplete}
            onExit={exitWird}
          />
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-emerald-50 to-teal-50 pb-20">
          <div className="bg-white shadow-sm">
            <div className="max-w-4xl mx-auto px-6 py-4">
              <h1 className="text-2xl font-bold text-gray-900">Digital Zawiya</h1>
            </div>
          </div>

          <div className="max-w-4xl mx-auto px-6 py-8">
            {activeTab === 'home' && (
              <div className="space-y-8">
                <div className="bg-white rounded-2xl shadow-lg p-8 text-center">
                  <h2 className="text-3xl font-bold text-gray-900 mb-4">Your Daily Wird</h2>
                  <p className="text-gray-600 mb-6">
                    100x Istighfar • 100x Tahlil • 100x Salawat • 3min Muraqabah
                  </p>
                  <button
                    onClick={startWird}
                    className="w-full bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white text-xl font-semibold py-6 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg"
                  >
                    Begin Daily Wird
                  </button>
                  <div className="mt-4 text-sm text-gray-500">
                    Current mode: {countingMode === 'B' ? 'Serene Visual' : 'Haptic Hudoor'}
                  </div>
                </div>

                <div>
                  <h2 className="text-2xl font-bold text-gray-900 mb-4">Our Foundations</h2>
                  {FOUNDATION_CARDS.map(card => (
                    <FoundationCard key={card.id} card={card} />
                  ))}
                </div>
              </div>
            )}

            {activeTab === 'path' && (
              <div>
                <h2 className="text-3xl font-bold text-gray-900 mb-6">My Path</h2>
                {MY_PATH_SECTIONS.map(section => (
                  <PathSection key={section.id} section={section} />
                ))}
              </div>
            )}

            {activeTab === 'silsilah' && (
              <div>
                <h2 className="text-3xl font-bold text-gray-900 mb-6">My Silsilah</h2>
                <div className="bg-emerald-50 rounded-xl p-6 mb-6">
                  <h3 className="text-xl font-bold text-emerald-900 mb-2">The Ahlul Bayt: Our Fountainhead</h3>
                  <p className="text-emerald-800">
                    Our spiritual lineage flows from the Prophet ﷺ and his blessed household. They are the ark of salvation and the gates to prophetic knowledge.
                  </p>
                </div>
                {SILSILAH_FIGURES.map(figure => (
                  <SilsilahCard key={figure.id} figure={figure} />
                ))}
              </div>
            )}

            {activeTab === 'settings' && (
              <div>
                <h2 className="text-3xl font-bold text-gray-900 mb-6">Settings</h2>
                <div className="space-y-4">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h3 className="text-lg font-bold text-gray-900 mb-4">Hudoor Engine</h3>
                    
                    <div className="mb-4">
                      <label className="block text-gray-700 mb-2">Counting Mode</label>
                      <select
                        value={countingMode}
                        onChange={(e) => setCountingMode(e.target.value)}
                        className="w-full border border-gray-300 rounded-lg px-4 py-2"
                      >
                        <option value="B">Mode B: Serene Visual</option>
                        <option value="C">Mode C: Haptic Hudoor</option>
                      </select>
                    </div>

                    <div className="flex items-center justify-between">
                      <span className="text-gray-700">Haptic Feedback</span>
                      <button
                        onClick={() => setHapticEnabled(!hapticEnabled)}
                        className={`px-4 py-2 rounded-lg ${
                          hapticEnabled ? 'bg-emerald-600 text-white' : 'bg-gray-200 text-gray-600'
                        }`}
                      >
                        {hapticEnabled ? 'On' : 'Off'}
                      </button>
                    </div>
                    {isIOS() && (
                      <p className="text-sm text-gray-500 mt-2">
                        Note: iOS uses visual cues instead of haptic feedback
                      </p>
                    )}
                  </div>

                  <div className="bg-white rounded-xl shadow-md p-6">
                    <h3 className="text-lg font-bold text-gray-900 mb-2">About</h3>
                    <p className="text-gray-600 mb-2">Digital Zawiya v1.0</p>
                    <p className="text-gray-600 text-sm">
                      A tool for consistent spiritual practice and learning.
                    </p>
                    <a
                      href="https://zawiya.org"
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-emerald-600 hover:text-emerald-700 text-sm mt-2 inline-block"
                    >
                      Visit Zawiya.org →
                    </a>
                  </div>
                </div>
              </div>
            )}
          </div>

          <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
            <div className="max-w-4xl mx-auto px-6 py-3 flex justify-around items-center">
              <button
                onClick={() => setActiveTab('home')}
                className={`flex flex-col items-center ${
                  activeTab === 'home' ? 'text-emerald-600' : 'text-gray-500'
                }`}
              >
                <Home size={24} />
                <span className="text-xs mt-1">Home</span>
              </button>
              <button
                onClick={() => setActiveTab('path')}
                className={`flex flex-col items-center ${
                  activeTab === 'path' ? 'text-emerald-600' : 'text-gray-500'
                }`}
              >
                <BookOpen size={24} />
                <span className="text-xs mt-1">My Path</span>
              </button>
              <button
                onClick={() => setActiveTab('silsilah')}
                className={`flex flex-col items-center ${
                  activeTab === 'silsilah' ? 'text-emerald-600' : 'text-gray-500'
                }`}
              >
                <Heart size={24} />
                <span className="text-xs mt-1">Silsilah</span>
              </button>
              <button
                onClick={() => setActiveTab('settings')}
                className={`flex flex-col items-center ${
                  activeTab === 'settings' ? 'text-emerald-600' : 'text-gray-500'
                }`}
              >
                <SettingsIcon size={24} />
                <span className="text-xs mt-1">Settings</span>
              </button>
            </div>
          </nav>
        </div>
      );
    };

    ReactDOM.render(<DigitalZawiyaApp />, document.getElementById('root'));
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => console.log('SW registered:', registration))
          .catch(error => console.log('SW registration failed:', error));
      });
    }
  </script>
</body>
</html>
